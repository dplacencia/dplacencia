---
import type { Locale, Translations } from "../i18n";
import ThemeToggle from "../components/ThemeToggle.astro";

const {
  title = "Daniel Placencia - Cloud & DevOps Consultant",
  description = "Cloud, DevOps, Kubernetes, AWS & AI Infrastructure consulting.",
  t,
  locale = "en",
} = Astro.props as {
  title?: string;
  description?: string;
  t: Translations;
  locale: Locale;
};

const currentPath = Astro.url.pathname;
const isActive = (path: string) =>
  currentPath === path || currentPath === `${path}/`;

const enPath = locale === "es" ? currentPath.replace(/^\/es/, "") || "/" : currentPath;
const esPath = locale === "es" ? currentPath : currentPath === "/" ? "/es" : `/es${currentPath}`;

import "../styles/global.css";
---

<html lang={locale} class="h-full">
  <head>
    <meta charset="utf-8" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="canonical" href={`https://dplacencia.com${currentPath}`} />
    <meta name="theme-color" content="#0b1224" />
    <meta property="og:site_name" content="dplacencia.com" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://dplacencia.com" />
    <meta name="twitter:card" content="summary" />
    <script is:inline>
      (function () {
        try {
          var stored = localStorage.getItem("theme");
          // Default to dark on first load; keep any saved choice
          var theme = stored || "dark";
          if (theme === "dark") {
            document.documentElement.classList.add("dark");
          } else {
            document.documentElement.classList.remove("dark");
          }
          // Persist the default so subsequent visits stay consistent
          if (!stored) localStorage.setItem("theme", theme);
        } catch (e) {
          console.error(e);
          // Safe fallback to dark if anything goes wrong
          document.documentElement.classList.add("dark");
        }
        document.documentElement.setAttribute("data-theme-initialized", "true");
      })();
    </script>
  </head>
  <body class="min-h-screen bg-slate-50 text-slate-900 antialiased flex flex-col dark:bg-slate-950 dark:text-slate-100">
    <header class="border-b border-slate-200/80 bg-white/80 backdrop-blur dark:border-slate-800/70 dark:bg-slate-950/80">
      <div class="mx-auto flex max-w-5xl flex-wrap items-center justify-between gap-3 px-4 py-4">
        <a href="/" class="font-semibold tracking-tight">
          dplacencia<span class="text-sky-600 dark:text-sky-400">.com</span>
        </a>
        <nav class="flex flex-wrap items-center gap-3 text-sm sm:gap-4">
          <a href={locale === "es" ? "/es" : "/"} class={`hover:text-sky-500 dark:hover:text-sky-400 ${isActive(locale === "es" ? "/es" : "/") ? "text-sky-600 dark:text-sky-400" : "text-slate-700 dark:text-slate-200"}`}>
            {t.nav.home}
          </a>
          <a
            href={locale === "es" ? "/es/services" : "/services"}
            class={`hover:text-sky-500 dark:hover:text-sky-400 ${isActive(locale === "es" ? "/es/services" : "/services") ? "text-sky-600 dark:text-sky-400" : "text-slate-700 dark:text-slate-200"}`}
          >
            {t.nav.services}
          </a>
          <a
            href={locale === "es" ? "/es/about" : "/about"}
            class={`hover:text-sky-500 dark:hover:text-sky-400 ${isActive(locale === "es" ? "/es/about" : "/about") ? "text-sky-600 dark:text-sky-400" : "text-slate-700 dark:text-slate-200"}`}
          >
            {t.nav.about}
          </a>
          <a
            href={locale === "es" ? "/es/working-together" : "/working-together"}
            class={`hover:text-sky-500 dark:hover:text-sky-400 ${isActive(locale === "es" ? "/es/working-together" : "/working-together") ? "text-sky-600 dark:text-sky-400" : "text-slate-700 dark:text-slate-200"}`}
          >
            {t.nav.workingTogether}
          </a>
          <a
            href={locale === "es" ? "/es/contact" : "/contact"}
            class={`hover:text-sky-500 dark:hover:text-sky-400 ${isActive(locale === "es" ? "/es/contact" : "/contact") ? "text-sky-600 dark:text-sky-400" : "text-slate-700 dark:text-slate-200"}`}
          >
            {t.nav.contact}
          </a>
          <div class="flex items-center gap-3">
            <div class="flex items-center gap-1 text-xs font-semibold text-slate-600 dark:text-slate-300">
              <a
                href={enPath}
                class={`px-2 py-1 rounded ${locale === "en" ? "bg-slate-200 text-sky-700 dark:bg-slate-800 dark:text-sky-400" : "hover:text-sky-500 dark:hover:text-sky-400"}`}
              >
                {t.nav.switcher.en}
              </a>
              <span class="text-slate-500">/</span>
              <a
                href={esPath}
                class={`px-2 py-1 rounded ${locale === "es" ? "bg-slate-200 text-sky-700 dark:bg-slate-800 dark:text-sky-400" : "hover:text-sky-500 dark:hover:text-sky-400"}`}
              >
                {t.nav.switcher.es}
              </a>
            </div>
            <ThemeToggle />
          </div>
        </nav>
      </div>
    </header>

    <main class="mx-auto max-w-5xl px-4 py-10 flex-1 w-full">
      <slot />
    </main>

    <footer class="border-t border-slate-200 mt-10 dark:border-slate-800/70">
      <div class="mx-auto flex max-w-5xl justify-between px-4 py-6 text-xs text-slate-600 dark:text-slate-400">
        <span>Â© {new Date().getFullYear()} Daniel Placencia</span>
        <span>{t.footer.tagline}</span>
      </div>
    </footer>
  </body>
</html>
